---
title: "ParseSims Trans Covar"
output: pdf_document
date: "2023-03-29"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
setwd("Routputs")
file_list <- list.files()

init_true_array <- matrix(0,2,length(file_list))
init_est_array <- matrix(0,2,length(file_list))

tran_true_array_1 <- array(0,dim = c(2,2,length(file_list)))
tran_est_array_1 <- array(0,dim = c(2,2,length(file_list)))

tran_true_array_2 <- array(0,dim = c(2,2,length(file_list)))
tran_est_array_2 <- array(0,dim = c(2,2,length(file_list)))

tran_true_array_3 <- array(0,dim = c(2,2,length(file_list)))
tran_est_array_3 <- array(0,dim = c(2,2,length(file_list)))

tran_true_array_4 <- array(0,dim = c(2,2,length(file_list)))
tran_est_array_4 <- array(0,dim = c(2,2,length(file_list)))

tran_true_array_5 <- array(0,dim = c(2,2,length(file_list)))
tran_est_array_5 <- array(0,dim = c(2,2,length(file_list)))

tran_true_array_6 <- array(0,dim = c(2,2,length(file_list)))
tran_est_array_6 <- array(0,dim = c(2,2,length(file_list)))

light_true_array <- array(0,dim = c(2,2,length(file_list)))
light_est_array <- array(0,dim = c(2,2,length(file_list)))

act_true_array <- array(0,dim = c(3,2,2,length(file_list)))
act_est_array <- array(0,dim = c(3,2,2,length(file_list)))

cor_true_array <- matrix(0,2,length(file_list))
cor_est_array <- matrix(0,2,length(file_list))

binom_true_array <- matrix(0,2,length(file_list))
binom_est_array <- matrix(0,2,length(file_list))

for (file_ind in 1:length(file_list)){
  load(file_list[file_ind])
  
  init_true_array[,file_ind] <- params_to_save[[1]][[1]]
  init_est_array[,file_ind] <- params_to_save[[2]][[1]]
  
  tran_true_array_1[,,file_ind] <- params_to_save[[1]][[2]][[1]]
  tran_est_array_1[,,file_ind] <- params_to_save[[2]][[2]][[1]]  
    
  tran_true_array_2[,,file_ind] <- params_to_save[[1]][[2]][[2]]
  tran_est_array_2[,,file_ind] <- params_to_save[[2]][[2]][[2]]
    
  tran_true_array_3[,,file_ind] <- params_to_save[[1]][[2]][[3]]
  tran_est_array_3[,,file_ind] <- params_to_save[[2]][[2]][[3]]
    
  tran_true_array_4[,,file_ind] <- params_to_save[[1]][[2]][[4]]
  tran_est_array_4[,,file_ind] <- params_to_save[[2]][[2]][[4]]
    
  tran_true_array_5[,,file_ind] <- params_to_save[[1]][[2]][[5]]
  tran_est_array_5[,,file_ind] <- params_to_save[[2]][[2]][[5]]
  
  tran_true_array_6[,,file_ind] <- params_to_save[[1]][[2]][[6]]
  tran_est_array_6[,,file_ind] <- params_to_save[[2]][[2]][[6]]
  
  light_true_array[,,file_ind] <- params_to_save[[1]][[3]]
  light_est_array[,,file_ind] <- params_to_save[[2]][[3]]
  
  act_true_array[,,,file_ind] <- params_to_save[[1]][[4]]
  act_est_array[,,,file_ind] <- params_to_save[[2]][[4]]
  
  cor_true_array[,file_ind] <- params_to_save[[1]][[5]]
  cor_est_array[,file_ind] <- params_to_save[[2]][[5]]
  
  
  binom_true_array[,file_ind] <- params_to_save[[1]][[6]]
  binom_est_array[,file_ind] <- params_to_save[[2]][[6]]
  
}
```

```{r}
library(ggplot2)
library(gridExtra)

AnalyzeResids <- function(true_array,est_array, index1, index2 = NA, title, index3 = NA){
  
  if (is.na(index2)){
    df <- data.frame(resid = est_array[index1,] - true_array[index1,])
    true_mean <- mean(true_array[index1,])
  } else if (is.na(index3)){
    df <- data.frame(resid = est_array[index1,index2,] - true_array[index1,index2,])
    true_mean <- true_array[index1,index2,]
  } else {
    if (index2 == 2){est_array[index1,index2,index3,] <- abs(est_array[index1,index2,index3,])}
    df <- data.frame(resid = est_array[index1,index2,index3,] - true_array[index1,index2,index3,])
    true_mean <- true_array[index1,index2,index3,]
  }
  
    binwid <- (max(df) - min(df))/12
    title <- paste("Residuals for",title)
  
  ggplot(df, aes(x = resid)) + 
    geom_histogram(colour="black", fill="white", binwidth = binwid)+
    geom_vline(aes(xintercept=0),
              color="blue", size=1) + 
    geom_vline(aes(xintercept=mean(resid)),
              color="red", linetype="dashed", size=1) + 
    xlab("Residuals") + 
    ggtitle(title, subtitle = paste("True Mean of Parameter is ",round(true_mean,2))) + 
    theme_gray()
  
}

```

```{r, fig.width=10}

grid.arrange(AnalyzeResids(init_true_array,init_est_array,1,title = "Initial Wake"),
             AnalyzeResids(init_true_array,init_est_array,2,title = "Initial Sleep"),
             nrow = 1)

  
grid.arrange(AnalyzeResids(tran_true_array_1,tran_est_array_1,1,2,"Wake to Sleep Transition 1"),
             AnalyzeResids(tran_true_array_1,tran_est_array_1,2,1,"Sleep to Wake Transition 1"),
             nrow = 1)

grid.arrange(AnalyzeResids(tran_true_array_2,tran_est_array_2,1,2,"Wake to Sleep Transition 2"),
             AnalyzeResids(tran_true_array_2,tran_est_array_2,2,1,"Sleep to Wake Transition 2"),
             nrow = 1)

grid.arrange(AnalyzeResids(tran_true_array_3,tran_est_array_3,1,2,"Wake to Sleep Transition 3"),
             AnalyzeResids(tran_true_array_3,tran_est_array_3,2,1,"Sleep to Wake Transition 3"),
             nrow = 1)

grid.arrange(AnalyzeResids(tran_true_array_4,tran_est_array_4,1,2,"Wake to Sleep Transition 4"),
             AnalyzeResids(tran_true_array_4,tran_est_array_4,2,1,"Sleep to Wake Transition 4"),
             nrow = 1)

grid.arrange(AnalyzeResids(tran_true_array_5,tran_est_array_5,1,2,"Wake to Sleep Transition 5"),
             AnalyzeResids(tran_true_array_5,tran_est_array_5,2,1,"Sleep to Wake Transition 5"),
             nrow = 1)

grid.arrange(AnalyzeResids(tran_true_array_6,tran_est_array_6,1,2,"Wake to Sleep Transition 6"),
             AnalyzeResids(tran_true_array_6,tran_est_array_6,2,1,"Sleep to Wake Transition 6"),
             nrow = 1)



grid.arrange(AnalyzeResids(light_true_array,light_est_array,1,1,"Wake Light Mean"),
             AnalyzeResids(light_true_array,light_est_array,1,2,"Wake Acitivy SE"),
             nrow = 1)

grid.arrange(AnalyzeResids(light_true_array,light_est_array,2,1,"Sleep Light Mean"),
             AnalyzeResids(light_true_array,light_est_array,2,2,"Sleep Light SE"),
             nrow = 1)



grid.arrange(AnalyzeResids(act_true_array,act_est_array,1,1,"Wake Activity Mean",1),
             AnalyzeResids(act_true_array,act_est_array,1,2,"Wake Activity SE",1),
             nrow = 1)
grid.arrange(AnalyzeResids(act_true_array,act_est_array,2,1,"Wake Activity Covar 1 Mean",1),
             AnalyzeResids(act_true_array,act_est_array,3,1,"Wake Activity Covar 2 Mean",1),
             nrow = 1)

grid.arrange(AnalyzeResids(act_true_array,act_est_array,1,1,"Sleep Activity Mean",2),
             AnalyzeResids(act_true_array,act_est_array,1,2,"Sleep Activity SE",2),
             nrow = 1)
grid.arrange(AnalyzeResids(act_true_array,act_est_array,2,1,"Sleep Activity Covar 1 Mean",2),
             AnalyzeResids(act_true_array,act_est_array,3,1,"Sleep Activity Covar 2 Mean",2), 
             nrow = 1)



grid.arrange(AnalyzeResids(cor_true_array,cor_est_array,1,title = "Wake Correlation"),
             AnalyzeResids(cor_true_array,cor_est_array,2,title = "Sleep Correlation"),
             nrow = 1)

grid.arrange(AnalyzeResids(binom_true_array,binom_est_array,1,title = "Act LoD"),
             AnalyzeResids(binom_true_array,binom_est_array,2,title = "Light LoD"),
             nrow = 1)

```